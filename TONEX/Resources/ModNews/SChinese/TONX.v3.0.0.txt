#Number:100043
#Title:TownOfNext v3.0.0
#SubTitle:★★★★TO The Next★★★★
#ShortTitle:★TONX v3.0.0
#Date:2023-11-16T00:00:00Z
#-----------------------------

## 对应官方版本
- 基于 AmongUs v2023.10.24
- 基于 TOH v5.1.3

## 警告
- 目前无法创建或加入公开房间，这是因为服务器端更新导致修改后的公共房间不适用于原版。私人房间不受影响。 目前，此更改不是永久性的。

## 您需要知道的
- 我们基于TOH v5.0.0往后的新的Base完全重构了TOHE，因此113个职业全部被重写。
- TONX接下来的版本可能Bug数量众多，如果可以的话请您及时反馈Bug并附带日志。
- 此外根据新Base的逻辑，在原版本中的部分职业冲突的情况可能由不触发变为强制执行，
- 因此新版本TONX在部分职业技能冲突下可能有微妙的规则差异。

## 代办
- 部分中立职业还未重写

## 云服务相关
- 车队姬未恢复
- EAC云服务未恢复
- 更新检查服务使用了定制格式的文件并可以多渠道自动获取（应该不会再卡了）
- 更新渠道首选Gitee（应该要快不少而且不用续费）

## 性能
- 优化游戏启动速度
- 优化击杀、灯光破坏的代码以避免部分卡顿
- 优化模组样式按钮的加载逻辑

## 修正
- 修复名字同步模式为颜色时玩家名字可能显示为“灰色”的问题
- 修复警长、侠客等反Base职业的视野在模组端异常的问题
- 修复豺狼在模组端无法使用破坏的问题
- 修复当非主机模组端为追踪者时最总位置无法追踪的问题
- 修复模组端大厅左侧显示TONX选项时重复显示了部分职业且布局异常的问题
- 修复量子幽灵的标记在会议上不可见的问题
- 修复观察者可以在首次会议前看到模组端玩家的CD重置碎盾动画的问题
- 修复和平之鸽重置了不该重置的技能冷却的问题
- 修复非房主模组端马里奥跳管次数与房主不同步的问题
- 修复市长手动拍灯被计入了技能使用次数的问题
- 修复对量子幽灵的击杀键互动没有被阻塞的问题
- 修复部分职业在自杀时会误触发技能的问题
- 修复部分内鬼在变形过程中召开会议导致名字显示为变形目标的名字的问题
- 修复快枪手的击杀冷却有时异常的问题
- 修复非模组端赌怪、法官与黑手党无法在会议上看到玩家ID的问题
- 修复非模组端愚者可能看不到红名的问题
- 修复非模组端可能看不到红名梦魇的问题
- 修复模组端HUD文本在死后或会议上不消失的问题
- 修复侠客在击杀失败后仍然可以继续击杀的问题
- 修复吟游诗人、狂妄杀手、贪婪者等在击杀失败后击杀冷却仍然被修改的问题
- 修复网红死亡后部分内鬼或中立可以得到通知的问题
- 修复当内鬼可击杀叛徒或叛徒可击杀内鬼选项对于部分职业无效的问题
- 修复当医生持有护盾并碎盾时若选项医生可得知目标护盾破碎启用时也会看到提示的问题
- 修复侦探、入殓师等部分职业在报告尸体时发生错误导致部分玩家职业外露的问题
- 修复部分跳管触发技能的职业不规则被弹出管道的问题
- 修复原版职业在查询时被视为隐藏职业的问题
- 修复玩家退出游戏后可能引发的一系列问题
- 修复玩家未达到房间规定等级时被连续多次踢出房间的问题
- 修复启用人满自动开始后在开始倒计时下依然显示开始按钮的问题
- 修复聊天框输入数字导致大厅的预设页面同时切换的问题
- 修复有时抹除者的技能不发动的问题
- 修复独裁发动技能时会议可能不会结束的问题
- 修复幽灵无视任务的选项可能不起作用的问题
- 修复断连玩家的任务可能任然被计入的问题
- 修复拥有跳管或变形按钮的玩家离开游戏可能造成的一些系列问题
- 修复非房主模组端显示其他玩家名字时可能错误的问题
- 修复模组端的幽幽鬼魂按钮与使用按钮有时候显示不正常的问题
- 修复模组样式按钮有时候会有一半颜色显示异常的问题
- 修复部分系统消息未被视为系统消息显示为自己发送的消息的问题
- 修复有时候非房主模组端玩家的名字变成别人的名字的问题
- 修复名字同步模式为颜色时部分非房主模组端的玩家名字显示与其实际颜色不同的问题
- 修复有时房间设置的名字后缀显示在了非房主玩家的名字下的问题
- 修复部分选项颜色与其他地方显示的颜色不同的问题
- 修复房主使用部分指令时头衔遮挡了系统消息内容的问题
- 修复更新时游戏崩溃或闪退的问题
- 修复破平者有时技能不触发或误触发的问题
- 修复开启全员共享会议次数时若拍灯因某职业技能被取消还是会扣除会议次数的问题
- 修复蠢蛋技能有时不生效或导致部分设施无法使用的问题
- 修复当双重人格中途改变阵营后双重人格增加的阵营人数还是原阵营导致技能起相反作用甚至在仅剩双重人格一人时游戏不结束的问题
- 修复/n指令显示的选项不完整的问题
- 修复执灯人技能有时不生效的问题
- 修复有时进房间会黑屏卡死没反应的问题
- 修复翻译相关代码的一个错误导致游戏启动后可能变回原版的问题
- 修复房主 /rename 指令在部分场景下不生效的问题
- 修复原版端玩家在会议上可能会看到其他玩家名字显示错误的问题
- 修复原版端玩家在会议上自己的名字颜色与职业不匹配的问题
- 修复原版端恋人自杀后无法看到其他玩家职业的问题
- 修复有时鹈鹕死亡或掉线后肚子里的玩家没有被传送回地图的问题
- 修复飞艇地图的部分设置无效的问题
- 修复有时非船员玩家的任务被计入全体成员任务的问题
- 修复豺狼所属阵营改变后依然被统计为豺狼的问题
- 修复加班狂注册错误的问题
- 修复会议时玩家名字可能遮住文本的问题
- 修复部分职业有时会黑屏的问题
- 修复从梯子摔死的玩家的尸体有时无法被报告的问题
- 修复梦魇有时没有击杀按钮的问题
- 修复嗜血杀手在驱逐画面也会进行自杀倒计时的问题
- 修复反黑屏功能有时不起作用的问题
- 修复根据投票模式改变选票的市长的票数没有增加的问题
- 修复模组端内鬼死亡后显示管理室地图导致无法破坏的问题
- 修复未开启中立职业一起胜利选项时部分中立职业可能同时胜利的问题
- 修复伪装结束时死亡玩家的宠物返回的问题
- 修复模组玩家可以进入正在清理的通风口的问题
- 修复原版职业按钮显示不正确的问题
- 修复了在变形过程中被杀死的玩家仍然变形的问题
- 修复了随机出生点在Polus开局时不起作用的问题

## 更改
- 如果禁用了摄像头则摄像头不会亮灯
- 修改了房间自动解散倒计时的样式
- 驱逐动画被覆盖的提示在测试模式下不会显示
- 低负载模式暂时无效
- 模组玩家的名字在大厅中呈粉色而不是蓝色
- 模组不同的玩家的名字提示文本更大更易于分辨
- 由于不可控原因全部隐藏职业被加入选项
- 玩家在掉线后会被视为死亡以解决部分问题
- 限制部分职业的选项数值可调范围以防止部分错误
- 附加职业将启用禁用替换为生成概率而不是使用一个子选项来设定概率
- 修改附加职业的生成逻辑，附加职业不再是非黑即白地出现指定数量或完全没有，而是根据设定概率来分配数量以及玩家
- 优化防黑屏措施的计算逻辑以免在非必要的时候覆盖了驱逐动画
- 直播模式下房间号显示的样式微调
- 主菜单UI优化与微调
- 马模式按钮从主菜单移动至设置选项
- 赌怪猜测界面放大、添加打开过渡动画以及选项卡的样式修改
- 移除“TONX大家族”界面并将原内容显示在AmongUs官方开发人员界面
- 右上角Ping显示区域微调并显示帧数与当前服务器
- 降低更新时进度显示频率以防止卡死进程或闪退
- 模组端管理员或死亡玩家打开地图默认显示所有人位置（管理室地图）
- 模组端的聊天信息可以显示彩色文本了
- 模组端的聊天消息字数上限修改（房主999，非房主300）
- 来自模组的特殊消息将会将消息气泡显示为黑色背景以便于区分
- 大厅左侧更小的选项预览字体以在一页显示更多的内容
- 创作者素材保护计划 => 导演模式（允许房主指定自己下局的职业）
- 非TONX房间的时候右上角不会继续显示其他信息
- 微调开局职业显示界面的字体（为了模组的辨识度 :p）
- 将开局职业显示文本覆盖的速度调快以防止高帧数情况下出现几帧未覆盖文本的情况
- 主动叛变模式下自票事件会被阻塞并允许您重新投票
- 修改了公告与模组更新界面
- 大部分游戏原界面按钮的配色由绿色换为粉色
- 重新排版系统设置面板为其分类并上色
- 选项：不限制玩家附加职业数量上限 => 玩家附加职业数量上限
- 优化了一键更新的代码
- 添加私服不会再影响现选中项
- 窃票者得到的附加票不会用名字提示而是常驻显示在任务旁
- 附加职业设置面板排版调整以可注册阵营分类显示
- 若游戏开始后立刻召开会议则不会进行首刀修正以避免一些潜在的错误
- 玩家死后不会在原地留下宠物
- 抹除者选择无效目标后可以重新选择抹除目标
- 翻译文件格式更改：.csv => .yaml
- 模组端玩家死后的跟随按钮将显示模组职业名而不是原版职业名
- 微调职业介绍的排版（包括/r指令、/m指令、F1快捷键）
- 大量英文翻译的修正与优化

## 删除
- 选项：快速启动模式（已针对启动速度进行优化）
- /s 指令（请使用快捷键选择发送目标代替）
- 选项：隐藏市长附加的投票（因技能发动方式修改不再需要）
- 选项：隐藏占卜师的投票（因技能发动方式修改不再需要）
- 选项：隐藏抹除者的投票（因技能发动方式修改不再需要）
- 贡献者消息
- 贡献者与开发者的头衔（将添加至新自定义头衔系统的默认加载项）
- /n all 指令（不适配）
- 个人竞技模式（不再可用）
- /xf 指令（不再需要）

## 新增
- 当房主掉线时自动结束游戏并显示“伪装者已断线”
- 选项：禁用移动平台（飞艇地图）
- 用于取消开始倒计时的按钮
- 选项：幽灵可见他人任务（区别于幽灵可见他人职业）
- 设置选项切换原版的确认界面
- 设置选项：输出日志
- 当狙击手未能击杀目标时提醒狙击手
- 当术士操控的目标未能击杀其他玩家时提醒术士
- 模组端可以看到其他玩家被踢出的原因例如等级不足、作弊、使用违禁词等
- 模组端玩家被踢出后通过弹窗显示被踢的原因
- 当被害妄想症达到技能使用上限时进行提示
- 所有通用附加职业可以设定在每个支持阵营的最大数量
- 所有通用附加职业可以设定强制分配给某个主职业
- 为豺狼恢复冷却时增加提示
- 为非模组端嗜血骑士增加免疫生效的持续提示
- 为呪狼的反杀成功增加提示
- 为赝品商增加重复出售的提示
- 赝品商可以看到客户的名字旁出现“▲”标记
- 为主菜单的部分按钮和组件添加交互动效
- 设置选项：游戏结束后自动返回大厅
- Skeld地图的保安室桌子上新增一个按钮用于切换显示万圣节的装扮
- 模板文件（欢迎消息与会议开始消息等）现在默认是彩色的了
- 房主按住Shift可以将消息发送给所有人
- 房主按住Ctrl可以将消息发送给所有死亡玩家
- 大厅时使用Ctrl+Tab切换至上一页预设显示
- 大厅的预设显示对每一页进行分类（原版设置/启用职业/内鬼职业/船员职业/中立职业/附加职业/游戏设置/系统设置）
- 大厅的预设显示可以使用滚轮向下滑动（不会影响到视野缩放）
- 打字时自动将不支持的字符替换为支持的字符以便于您不再需要一直切换中英输入
- 检查 Among Us 版本是否支持
- 模组端占卜师可以通过弹窗显示占卜结果
- 模组端抹除者可以通过弹窗显示抹除结果
- 检查更新失败会进行提示并允许玩家重试
- 更新失败会显示失败原因并提示可能的解决方法
- 自定义头衔管理系统以及完善的设置界面（在主菜单选项里）
- 选项：允许玩家携带彩色名字（自定义头衔系统）进入游戏
- 选项：为非模组端玩家应用多行头衔（会导致消息被挡）
- 更新时可选择更新渠道（Github/Gitee/Cos）
- 更新下载时可以取消
- 自动添加更多的私服
- 选择服务器界面若溢出屏幕显示范围则可以滑动
- 选项：清理工清理尸体后重置击杀冷却
- 选项：诡雷设陷后自杀延迟
- 选项：内鬼成为蠢蛋后不可以进行破坏
- 选项：蠢蛋不能开门
- 选项：复仇者复仇对象/次数
- 选项：复仇者自杀/被杀时候复仇
- 大厅里按 Alt+O 复制设置数据
- 大厅里按 Alt+P 应用剪辑版中的设置数据
- 大厅里按 Alt+L 导出设置数据到文件
- 将在必要时自动开启调试模式
- 设置界面调整数值时按住Shift以连续进行5次调整
- 选项：破坏冷却时长
- 选项：在会议后重置门的状态为：开启/关闭/随机
- 稍微修改了游戏结束界面的复盘信息的格式
- 稍微修改了游戏结束后复盘消息的格式
- 对AU方面若玩家在管道内时开会导致弹出管道的操作会被保留的问题的解决方案
- 在结果屏幕上折叠角色列表的功能
- 选项：禁用Fungle的蘑菇混合

## 角色更改
- 所有技能优先度变更，故部分职业互发动技能与往常稍有区别，请自行测试，请反馈您认为不合理的变更，因为这些改版并不是我们故意也不受我们控制。我们会在接受反馈后尽快修改恢复
- 梦魇的技能以及红名会在灯光破坏的4秒后发动而不是立刻发动
- 烟花商人引爆烟花不再有冷却
- 网红现在可以成为叛徒（叛徒网红技能改为所有人可知网红死亡）
- 老兵现在可以反伤一些使其被动自杀的技能例如吸血鬼、船鬼等
- 医生的护盾现在可以避免一些原本不能抵挡的伤害
- 嗜血骑士的技能现在可以避免一些原本不能抵挡的伤害
- 幸运儿的技能现在可以避免一些原本不能抵挡的伤害
- 独裁者可以进行正常投票并通过连续两次投票给相同玩家触发技能
- 占卜师占卜不计票并可以在占卜完成或占卜次数耗尽后正常投票
- 抹除者抹除不计票并可以在抹除发动或抹除次数耗尽后正常投票
- 诱饵的技能触发对象改为实际击杀来源而不是表面上击杀诱饵的玩家（术士操控、吸血鬼吸血等均可以触发诱饵技能）
- 陷阱师技能的对象改为实际击杀来源而不是表面上击杀陷阱师的玩家（同上）
- 内鬼现在可以成为蠢蛋
- 原版船员现在是蓝色
- 模组端纵火犯的跳管提示将会显示在屏幕中下方
- 恋人不再会抢夺胜利而是互相跟随胜利（待修复）
- 梦魇与隐蔽者由于没有电力系统不会出现在蘑菇岛地图

## 角色新增
- 内鬼阵营：企鹅
- 内鬼阵营：情报贩子
- 内鬼阵营：内幕人
- 内鬼阵营：暗杀者
- 中立阵营：疫医
- 中立阵营：薛定谔的猫